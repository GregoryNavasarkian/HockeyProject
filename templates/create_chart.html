{% extends "layout.html" %}
{% block content %}

    <div class="additional_canvas_options">
      <button id="undo_button" class="btn btn-secondary">Undo</button>
      <button id="goal_button" class="btn btn-success">Goal</button>
      <button id="miss_button" class="btn btn-danger">Miss</button>
      <button id="save_button" class="btn btn-primary">Save</button>
    </div>
    <div class="hockey_canvas">
      <svg viewbox="-1000 -425 2000 850" id="hockey_rink">
          <rect x="-1000" y="-425" rx="100" ry="100" width="100%" height="100%" style="fill:rgb(237, 237, 255);stroke-width:3;stroke:black"/>
          <line x1="0" y1="-425" x2="0" y2="425" style="stroke:red;stroke-width:3"/>
          <circle cx="0" cy="0" r="150" stroke="blue" stroke-width="3" fill="none"/>
          <line x1="300" y1="-425" x2="300" y2="425" style="stroke:blue;stroke-width:3"/>
          <line x1="-300" y1="-425" x2="-300" y2="425" style="stroke:blue;stroke-width:3"/>
          <line x1="900" y1="-425" x2="900" y2="425" style="stroke:red;stroke-width:3"/>
          <line x1="-900" y1="-425" x2="-900" y2="425" style="stroke:red;stroke-width:3"/>
          <rect x="-943" y1="-30" width="40" height="60" style="fill:grey;stroke-width:3;stroke:grey"/>
          <rect x="903" y1="-30" width="40" height="60" style="fill:grey;stroke-width:3;stroke:grey"/>

          {% if coordinates_list %}
            {% for shot in coordinates_list %}
              <circle cx="{{ shot[0] }}" cy="{{ shot[1] }}" r="5" fill="red"/>
            {% endfor %}
          {% endif %}
      </svg>
    </div>
    <div class="input_form">
      <form action="/save_chart" method="post">
        <input type="hidden" name="shot_coordinates" id="shot_coordinates">
        <label for="chart_name">Chart Name:</label>
        <input type="text" name="chart_name" id="chart_name">
        <br>
        <label for="chart_date">Chart Date:</label>
        <input type="date" name="chart_date" id="chart_date">
        <br>
        <input type="submit" value="Save Chart" name="save_chart_button" class="btn btn-primary">
        <input type="submit" value="Clear Chart" name="clear_chart_button" class="btn btn-danger">
      </form>
    </div>
    <script>

        document.getElementById('chart_date').valueAsDate = new Date();

        var shot_coordinates = [];
        

        var hockey_rink = document.getElementById("hockey_rink");
        var pt = hockey_rink.createSVGPoint();

        var goal_button = document.getElementById('goal_button');
        goal_button.addEventListener("click", function(evt) {
            if (goal_button.classList.contains('active')) {
                goal_button.classList.remove('active');
            } else {
                goal_button.classList.add('active');
            }
        });

        hockey_rink.addEventListener("click", function(evt) {
            pt.x = evt.clientX;
            pt.y = evt.clientY;
            var cursorpt =  pt.matrixTransform(hockey_rink.getScreenCTM().inverse());

            var shot_color = "red";

            //check if the goal button is pressed
            if (document.getElementById('goal_button').classList.contains('active')) {
                shot_color = "green";
                goal_button.classList.remove('active');
            }

            //draw a circle at the click location
            var circle = document.createElementNS("http://www.w3.org/2000/svg", "circle");
            circle.setAttributeNS(null, "cx", cursorpt.x);
            circle.setAttributeNS(null, "cy", cursorpt.y);
            circle.setAttributeNS(null, "r", 5);
            circle.setAttributeNS(null, "fill", shot_color);
            hockey_rink.appendChild(circle);
            shot_coordinates.push([cursorpt.x, cursorpt.y, shot_color]);
            document.getElementById('shot_coordinates').value = JSON.stringify(shot_coordinates);

        });
    
    </script>
{% endblock %}